import { Resend } from 'resend';
import { supabaseAdmin } from '@/lib/supabase/server';

export const resend = new Resend(process.env.RESEND_API_KEY);

export const EMAIL_FROM = 'SKY ROCK <support@skyrockkhaolak.com>';

// Parse comma-separated emails into array
export function parseEmails(emailString: string): string[] {
  return emailString
    .split(',')
    .map(email => email.trim())
    .filter(email => email.length > 0 && email.includes('@'));
}

// Get notification settings from database
export async function getNotificationSettings() {
  try {
    const { data, error } = await supabaseAdmin
      .from('settings')
      .select('value')
      .eq('key', 'notifications')
      .single();

    if (error || !data) {
      return {
        emailNotifications: true,
        bookingNotificationEmails: 'booking@skyrockkhaolak.com',
        contactNotificationEmails: 'contact@skyrockkhaolak.com',
        sendCustomerConfirmation: true,
      };
    }

    return data.value as {
      emailNotifications: boolean;
      bookingNotificationEmails: string;
      contactNotificationEmails: string;
      sendCustomerConfirmation: boolean;
    };
  } catch {
    return {
      emailNotifications: true,
      bookingNotificationEmails: 'booking@skyrockkhaolak.com',
      contactNotificationEmails: 'contact@skyrockkhaolak.com',
      sendCustomerConfirmation: true,
    };
  }
}
